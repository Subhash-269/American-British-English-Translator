#!/usr/bin/env node

var translator = require('../lib/american-british-english-translator');
var fs = require('fs');
var argv = require('minimist')(process.argv.slice(2));
var prettyjson = require('prettyjson');

var options = {
	american: argv.american,
	british: argv.british,
	exclusive: argv.exclusive,
	spelling: argv.spelling,
	different: argv.different,
	showall: argv.showall	
};

var translate = function(input){
	translated = translator.translate(input, options);

	if (require.main === module) {
		if ((Object.keys(translated).length === 1) && translated[0]) console.log(prettyjson.render(translated[0]));
		else console.log(prettyjson.render(translated));
	} else {
    		return JSON.stringify(translated);
	}
};

if (argv._.length) {
	// First parameter is the file to read and parse
	var filename = argv._[0];
	translate(fs.readFileSync(filename, 'utf8'));

} else {
	// Read input stream

	var streamData = '';

	process.stdin.resume();
	process.stdin.setEncoding('utf8');
	process.stdin.on('data', function (chunk) {
		if (chunk === '\n') {
			translate(streamData);
			streamData = '';
			return;
		}
		streamData += chunk;
	});
	process.stdin.on('end', function(){
		translate(streamData);
	});
}
